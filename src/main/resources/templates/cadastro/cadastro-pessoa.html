<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="UTF-8">

 <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
 <link type="text/css" rel="stylesheet" href="/materialize/css/materialize.css"  media="screen,projection"/>
 <link type="text/css" rel="stylesheet" href="/materialize/css/materialize.min.css"  media="screen,projection"/>
  <!-- Adicionando JQuery -->
 <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
 <link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />
 <script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>

 
  <!-- Adicionando JQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"
	integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
	crossorigin="anonymous"></script>
	
<style type="text/css">
table{
	width: 100%;
}
table th, table td{
	border-bottom: 1px solid #2BBBAD;
}
table th{
	background: #eee;
}
footer ul li{
  display: inline;
  margin: 1px 1px 10px -8px;
  padding: 5px;

}
.page-footer {
	background-color:#2BBBAD;

}


</style>

<title>CADASTRO</title>
</head>
<body>
		<div class="row">
			<div class="input-field col s6">
				<a href="/logout"><button class="btn waves-effect waves-light" name="action">SAIR<i class="material-icons right">call_made</i></button></a>
				<!-- <button class="btn waves-effect waves-light" name="action" onclick="document.getElementById('formCadastro').reset();">Novo<i class="material-icons right">send</i></button> -->
			</div>
		</div>
	<fieldset style="border: 2px solid #2BBBAD; color:#561419;">
		<legend style="font-size: 20pt">Cadastro de Usuario</legend>
		<div th:each = "m : ${msg}" class="input-field col s6">
			<span th:text = "${m}"></span>
		</div>
		<div class="row">
	
		<form action="salvar-cadastro" method="post" th:object="${objPessoa}" class="col s12" id="formCadastro" enctype="multipart/form-data">
	
		<input type="hidden" th:field="*{id}" name="id">
	
		<div class="row" >
			<div class="input-field col s6">
				<label for="nome" class="active">Nome</label>
				<input type ="text" name="nome" th:field="*{nome}" id="nome"/>
			</div>
			<div class="input-field col s6">
				<label for="sobrenome"  class="active">Sobrenome</label>
				<input type="text" name="sobrenome"th:field="*{sobrenome}" id="sobrenome"/>
			</div>
		</div>
		<div class="row">
			<div class="input-field col s6" >
				<label for="sexo" class="active">GENERO</label>
				<select th:field="*{genero}">
					<option value="" disabled selected>---[SELECIONE]---</option>
					<option value="MASCULINO" th:text="Masculino" />
					<option value="FEMININO" th:text="Feminino" />
				</select>
			</div>
			<div class="input-field col s6">
				<label for="dataNascimento"  class="active">DATA NASCIMENTO</label>
				<input type="date" id="dataNascimento" th:field="*{dataNascimento}" name="dataNascimento" placeholder="Data Nasc.">
			</div>
		</div>	
		<div class="row">
			<div class="input-field col s6" >
				<label for="idade"  class="active">Idade</label>
				<input type="number" name="idade" th:field="*{idade}" id="idade"/>
			</div>
			<div class="input-field col s6" >
				<label for="cep"  class="active">CEP</label>
				<input type="text" name="cep" id="cep" th:field="*{cep}"/>
			</div>
		</div>
		<div class="row">
			<div class="row">
			<div class="input-field col s6" >
				<label for="rua"  class="active">RUA</label>
				<input type="text" name="rua" id="rua" th:field="*{rua}"/>
			</div>
			<div class="input-field col s6">
				<label for="bairro"  class="active">BAIRRO</label>
				<input type="text" name="bairro" id="bairro" th:field="*{bairro}"/>
			</div>
			</div>
		</div>
		<div class="row">
			<div class="input-field col s6">
				<label for="cidade"  class="active">CIDADE</label>
				<input type="text" name="cidade"  id="cidade" th:field="*{cidade}"/>
			</div>
			<div class="input-field col s6">
				<label for="uf"  class="active">ESTADO</label>
				<input type="text" name="uf" id="uf" th:field="*{uf}"/>
			</div>
		</div>
		<div class="row">
			<div class="input-field col s12">
				<label for="ibge"  class="active">IBGE</label>
				<input type="text" name="ibge"  id="ibge" th:field="*{ibge}"/>
			</div>
		</div>
		<div class="row">
			<div class="input-field col s6">
				<label for="profissao"  class="active">PROFISSÃO</label>
				<select th:field="*{profissao}" id="profissao">
					<option value="" disabled selected>---[SELECIONE]---</option>
					<option th:each = "p : ${profissoes}" th:value="${p.id}" th:text="${p.descricao}"></option>
				</select>
			</div>
			<div class="input-field col s6">
				<label for="cargo"  class="active">CARGO</label>
				<select th:field="*{cargo}" id="cargo">
					<option value="" disabled selected>---[SELECIONE]---</option>
					<option th:each = "cg : ${T(com.projectweb.projectwebmvc.enums.Cargo).values()}" th:value="${cg}" th:text="${cg.descricao}"></option>
				</select>
			</div>
		</div>
   	 	<div class="file-field input-field">
      		<div class="btn">
        		<span>ENVIAR ARQUIVO<i class="tiny material-icons right">file_upload</i></span>
        		<input type="file" name="file" id="file" class="Validate" >
      		</div>
      		<div class="file-path-wrapper">
        		<input class="file-path validate" type="text" th:field="*{nameArquivo}">
      		</div>
    	</div>
		<div class="row">
			<div class="input-field col s6">
				<button class="btn waves-effect waves-light" type="submit" name="action">SALVAR<i class="material-icons right">send</i></button>
				<!-- <button class="btn waves-effect waves-light" name="action" onclick="document.getElementById('formCadastro').reset();">Novo<i class="material-icons right">send</i></button> -->
			</div>
		</div>
		</form>
		</div>
	</fieldset>
	<br/>
	<br/>
	<fieldset  sec:authorize="hasRole('ROLE_ADMIN')" style="border: 2px solid #2BBBAD; color:#561419;">
		<legend style="font-weight: 600;">CAMPO DE PESQUISA</legend>
		<div class="row" sec:authorize="hasRole('ROLE_ADMIN')">
		
			<form action="pesquisa-cadastro" method="post" class="col s12" id="pesquisaCadastro">
				<div class="row">
					<div class="input-field col s6">
						<label for="nomePesquisa" class="active">Buscar por Nome</label>
						<input type="text" name="nomePesquisa" id="nomePesquisa" th:value="${nomePesquisa}"/>
					</div>
					<div class="input-field col s6">
						<label for="generoPesquisa" class="active">Buscar por Genero</label>
						<select name="generoPesquisa" id="generoPesquisa">
							<option value="">Ambos</option>
							<option value="MASCULINO" th:text="Masculino" />
							<option value="FEMININO" th:text="Feminino" />
						</select>

					</div>
					<div class="input-field col s12">
						<button class="btn waves-effect waves-light" type="submit" name="action">Buscar<i class="material-icons right">search</i></button>
						<a href="listar-cadastro" class="btn waves-effect waves-light">LISTAR USUARIOS<i class="material-icons right">view_headline</i></a>
						<button class="btn waves-effect waves-light" type="submit" name="action" onclick="document.getElementById('pesquisaCadastro').method = 'get'">Download do Relatório<i class="material-icons right">file_upload</i> </button>

					</div>
				</div>
			</form>
		</div>
	</fieldset>
	<table class="highlight centered" >
		<thead>
			<tr>
				<th sec:authorize="hasRole('ROLE_ADMIN')">CODIGO</th>
				<th>NOME</th>
				<th>SOBRENOME</th>
				<th>IDADE</th>
				<th>ARQUIVO</th>
				<th colspan="2">AÇÕES</th>
			</tr>
		</thead>
		<tr th:each = "pessoa :${pessoas}">
			<td th:text = "${pessoa.id}" sec:authorize="hasRole('ROLE_ADMIN')"></td>
			<td><a th:href="@{/telefones-cadastro/{id}(id=${pessoa.id})}"><span th:text = "${pessoa.nome}"></span></a></td>
			<td th:text = "${pessoa.sobrenome}"></td>
			<td th:text = "${pessoa.idade}"></td>
			<td>
			<a th:if="${pessoa.arquivo != null}" th:href="@{/download-arquivo/{id}(id=${pessoa.id})}" sec:authorize="hasAnyRole('ROLE_ADMIN', 'ROLE_GERENTE')">Baixar <i class="tiny material-icons">file_download</i> </a>
			<a th:if="${pessoa.arquivo == null}" style="color:inherit;">Usuario não possui arquivo</a>
			</td>
			<td><a th:href="@{/editar-cadastro/{id}(id=${pessoa.id})}" sec:authorize="hasAnyRole('ROLE_ADMIN', 'ROLE_GERENTE')">Editar<i class="tiny material-icons">border_color</i></a></td>
			<td><a th:href="@{/remover-cadastro/{id}(id=${pessoa.id})}" sec:authorize="hasRole('ROLE_ADMIN')">Excluir<i class="material-icons">delete</i></a></td>
		</tr>
	</table>
	<div class="row" style="margin-top: 20px; text-align: center;">
			<div th:if="${pessoas != null}">
				<span th:if="${pessoas.hasPrevious()}">
					<a th:href="@{/paginas-cadastros(page=${pessoas.number-1}, size=${pessoas.size}, nomePesquisa=${nomePesquisa})}"><i class="tiny material-icons">fast_rewind</i></a></span>
				<th:block th:each="i: ${#numbers.sequence(0, pessoas.totalPages - 1)}"  >
					<a th:href="@{/paginas-cadastros(page=${i}, size=${pessoas.size}, nomePesquisa=${nomePesquisa})}" >[[ ${i} + 1 ]]</a>
				</th:block>
				<span th:if="${pessoas.hasNext()}">
					<a th:href="@{/paginas-cadastros(page=${pessoas.number+1}, size=${pessoas.size}, nomePesquisa=${nomePesquisa})}"><i class="tiny material-icons">fast_forward</i></a></span>
			</div>
	</div>
	
	<footer class="page-footer">
          <div class="container">
            <div class="row">
              <div class="col l6 s12" >
                <h5 class="white-text" >Robson Silva</h5>
                <p class="grey-text text-lighten-4">Development Full Stack Java</p>
              </div>
              <div class="col l4 offset-l2 s12" >
                <h5 class="white-text">Contato</h5>
                <ul >
                  <li><a class="grey-text text-lighten-3" href="https://www.linkedin.com/in/robsonweenden/" target="_blank"><img alt="Rede social Linkedin" src="/img/linke.png" style="width: 30px;"> </a></li>
                  <li><a class="grey-text text-lighten-3" href="#!"><img alt="Rede social Linkedin" src="/img/insta.png" style="width: 31px;"></a></li>
                  <li><a class="grey-text text-lighten-3" href="#!"><img alt="Rede social Linkedin" src="/img/tube.png" style="width: 35px;"></a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="footer-copyright">
            <div class="container">
            © 2021 Copyright - Robson Silva
           <!--  <a class="grey-text text-lighten-4 right" href="#!">More Links</a> -->
            </div>
          </div>
        </footer>
	<script type="text/javascript" src="/materialize/js/materialize.min.js"></script>
	<script type="text/javascript" src="/materialize/js/materialize.js"></script>
	
	
	
	 <!-- Adicionando Javascript -->
    <script>

        $(document).ready(function() {
        	
        	$('#dataNascimento').datepicker({
        		showOthermonths:true,
        		format:'yyyy-mm-dd'
        	});

            function limpa_formulário_cep() {
                // Limpa valores do formulário de cep.
                $("#rua").val("");
                $("#bairro").val("");
                $("#cidade").val("");
                $("#uf").val("");
                $("#ibge").val("");
            }
            
            //Quando o campo cep perde o foco.
            $("#cep").blur(function() {

                //Nova variável "cep" somente com dígitos.
                var cep = $(this).val().replace(/\D/g, '');

                //Verifica se campo cep possui valor informado.
                if (cep != "") {

                    //Expressão regular para validar o CEP.
                    var validacep = /^[0-9]{8}$/;

                    //Valida o formato do CEP.
                    if(validacep.test(cep)) {

                        //Preenche os campos com "..." enquanto consulta webservice.
                        $("#rua").val("...");
                        $("#bairro").val("...");
                        $("#cidade").val("...");
                        $("#uf").val("...");
                        $("#ibge").val("...");

                        //Consulta o webservice viacep.com.br/
                        $.getJSON("https://viacep.com.br/ws/"+ cep +"/json/?callback=?", function(dados) {

                            if (!("erro" in dados)) {
                                //Atualiza os campos com os valores da consulta.
                                $("#rua").val(dados.logradouro);
                                $("#bairro").val(dados.bairro);
                                $("#cidade").val(dados.localidade);
                                $("#uf").val(dados.uf);
                                $("#ibge").val(dados.ibge);
                            } //end if.
                            else {
                                //CEP pesquisado não foi encontrado.
                                limpa_formulário_cep();
                                alert("CEP não encontrado.");
                            }
                        });
                    } //end if.
                    else {
                        //cep é inválido.
                        limpa_formulário_cep();
                        alert("Formato de CEP inválido.");
                    }
                } //end if.
                else {
                    //cep sem valor, limpa formulário.
                    limpa_formulário_cep();
                }
            });
        });
        
        $(document).ready(function(){
            $('select').formSelect();
          });

    </script>

</body>
</html>